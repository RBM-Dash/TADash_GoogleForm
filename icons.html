<div>Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/catalin-fertu" title="Catalin Fertu">Catalin Fertu</a> from
        <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>
</div>
<div>Icons made by <a href="https://www.flaticon.com/authors/gregor-cresnar" title="Gregor Cresnar">Gregor Cresnar</a>
        from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/swifticons" title="Swifticons">Swifticons</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/retinaicons" title="Retinaicons">Retinaicons</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/smashicons" title="Smashicons">Smashicons</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/those-icons" title="Those Icons">Those Icons</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/smartline" title="Smartline">Smartline</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/prosymbols" title="Prosymbols">Prosymbols</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/pixel-perfect" title="Pixel perfect">Pixel perfect</a> from
        <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>
</div>
<div>Icons made by <a href="https://www.flaticon.com/authors/monkik" title="monkik">monkik</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/good-ware" title="Good Ware">Good Ware</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/vectors-market" title="Vectors Market">Vectors Market</a>
        from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/vitaly-gorbachev" title="Vitaly Gorbachev">Vitaly
                Gorbachev</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/mynamepong" title="mynamepong">mynamepong</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/srip" title="srip">srip</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/turkkub" title="turkkub">turkkub</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/kiranshastry" title="Kiranshastry">Kiranshastry</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/dmitri13" title="dmitri13">dmitri13</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/eucalyp" title="Eucalyp">Eucalyp</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/wanicon" title="wanicon">wanicon</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/icongeek26" title="Icongeek26">Icongeek26</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/ultimatearm" title="ultimatearm">ultimatearm</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/nikita-golubev" title="Nikita Golubev">Nikita Golubev</a>
        from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/flat-icons" title="Flat Icons">Flat Icons</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/itim2101" title="itim2101">itim2101</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/catkuro" title="catkuro">catkuro</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/phatplus" title="phatplus">phatplus</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/becris" title="Becris">Becris</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/inipagistudio" title="inipagistudio">inipagistudio</a> from
        <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>
</div>
<div>Icons made by <a href="https://www.flaticon.com/authors/nhor-phai" title="Nhor Phai">Nhor Phai</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/ddara" title="dDara">dDara</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/mavadee" title="mavadee">mavadee</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/xnimrodx" title="xnimrodx">xnimrodx</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/iconixar" title="iconixar">iconixar</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
<div>Icons made by <a href="https://www.flaticon.com/authors/surang" title="surang">surang</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>


complete: function (results) {
//Erase records where cname is empty
let result = _.reject(results.data, { 'cname': null });
result = _.reject(result, { 'cname': "Country" });
result = _.reject(result, ['Activity', null]);
console.log(result)
//Correct Dates for all
result = _.forEach(result, function (value) {
var currentTime = new Date();
var myDate = new Date(value.OSDate);
if (myDate.getFullYear() === currentTime.getFullYear()) {
//Modify the date so that due date is the end of the month if not defined
var d = new Date(myDate.getFullYear(), myDate.getMonth() + 1, 0);
startDate = d;
endDate = new Date(myDate.getFullYear(), myDate.getMonth() + 2, 30);
} else {
//Retrieve the Date from the quarter and year but only if there is not a full Date
if (!(_.isFinite(value.StartYear))) { value.StartYear = currentTime.getFullYear() };
if ((_.isFinite(value.StartYear))) {
endDate = new Date(currentTime.getFullYear(), (value.StartMonth + 1), 30);
startDate = new Date(currentTime.getFullYear(), (value.StartMonth - 1), 28);
} else {
endDate = new Date(currentTime.getFullYear(), (value.StartQuarter * 3 + 2), 30);
startDate = new Date(currentTime.getFullYear(), (value.StartQuarter * 3), 1);
}
}
value.startDate = startDate;
value.endDate = endDate;
value.due = ((currentTime - startDate) > 0);
//console.log(value);
});
//Start filling the info boxes
//These are all TAs in the Table. Appear under label "TA Needs"
$("#TAPlanned").text(result.length);
//Create the denominator for all analysis in the info-boxes. This is result with due = true
//First fill in all the Managed TAs considering only the due tasks. HERE
var notRequested = (_.filter(result, ['Status', "Not Requested"]));

var dueResult = (_.filter(result, ['due', true]));

dueResult = _.reject(dueResult, ['Status', "Not Requested"]);
console.log(dueResult);
$("#TARequested").text(dueResult.length + notRequested.length);
//These are all TAs in the Table minus the Not requested ones. Appear under label "TA Managed. This is the Denominator
for the rest"
$("#TACompleted").text(_.filter(dueResult, ['Status', "Completed"]).length);
$("#TAOngoing").text(_.filter(dueResult, ['Status', "Ongoing"]).length + _.filter(dueResult, ['Status',
"Requested"]).length);
$("#TAPostponed").text(_.filter(dueResult, ['Status', "Postponed"]).length);

var myNum;
var myNumC = _.filter(dueResult, ['Status', "Completed"]).length;
myNum = 100 * (myNumC / (dueResult.length));
//$("#PercentTACompleted").width(myNum.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0
}));
$("#PercentTACompleted").attr("style", "width:" + myNum.toLocaleString(undefined, { minimumFractionDigits: 0,
maximumFractionDigits: 0 }) + "%");
$("#textPercentTACompleted").text(myNum.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0
}) + "% of managed TAs");

var myNumO = (_.filter(dueResult, ['Status', "Ongoing"]).length + _.filter(dueResult, ['Status', "Requested"]).length);
myNum = 100 * myNumO / (dueResult.length);
$("#PercentTAOngoing").attr("style", "width:" + myNum.toLocaleString(undefined, { minimumFractionDigits: 0,
maximumFractionDigits: 0 }) + "%");
$("#textPercentTAOngoing").text(myNum.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 })
+ "% of managed TAs");

var myNumP = (_.filter(dueResult, ['Status', "Postponed"]).length);
myNum = 100 * myNumP / (dueResult.length);
$("#PercentTAPostponed").attr("style", "width:" + myNum.toLocaleString(undefined, { minimumFractionDigits: 0,
maximumFractionDigits: 0 }) + "%");
$("#textPercentTAPostponed").text(myNum.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0
}) + "% of managed TAs");
//By requested we mean the ones that have been or are under processing
var myNume = _.filter(dueResult, ['Status', "Ongoing"]).length + _.filter(dueResult, ['Status', "Completed"]).length +
_.filter(dueResult, ['Status', "Postponed"]).length;
myNum = 100 * myNume / (dueResult.length + notRequested.length);
//$("#PercentTARequested").width(myNum.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0
}));
$("#PercentTARequested").attr("style", "width:" + myNum.toLocaleString(undefined, { minimumFractionDigits: 0,
maximumFractionDigits: 0 }) + "%");
$("#textPercentTARequested").text(myNum.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0
}) + "% of due TAs managed ");


//Populate dropdown list of countries
var countries = _.map(result, 'cname').filter(onlyUnique);
countries = countries.sort();
const ocountries = _.map(result, 'cname').filter(onlyUnique);

var lCountries = $("#cselect");

$(countries).each(function () {
var option = $("<a></a>");

//Set country Name in Text part.
option.html(this);

//Set class and href.
$(option).attr("class", "dropdown-item text-xs");
$(option).attr("href", "#");

//console.log(option)
//Add the Option element to DropDownList.
lCountries.append(option);
});

/* var temp; let myData = []; let tmp; let startDate;
let cont = 1; */
var myCountry = countries;

//Find a way to monitor the dropdown list and filter by country if requested

$("#cselect a").on('click', function (e) {
e.preventDefault(); // cancel the link behaviour
var myCountry = [$(this).text()];
if (myCountry[0] === "All") { myCountry = countries };

g = fillGantt(result, myCountry, 10);

g.Draw();
});
var g = fillGantt(result, myCountry, 10);
g.Draw();
//Find a way to monitor the status dropdown list and filter by status if requested
var fresult;
$("#sselect a").on('click', function (e) {
e.preventDefault(); // cancel the link behaviour
var myStatus = [$(this).text()];
if (myStatus[0] === "All") {
fresult = result
} else {

if (myStatus[0].startsWith("Pending")) { myStatus[0] = "Undefined" }
fresult = _.filter(result, ['Status', myStatus[0]])

};

g = fillGantt(fresult, myCountry, 300);

g.Draw();
});
var g = fillGantt(result, myCountry, 10);
g.Draw();



},

});